<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CS2 Inventory</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0f1015;
            --card: #1c1e26;
            --accent: #4b89ff;
            --rare: #4b69ff;
        }
        body {
            background: var(--bg);
            color: #fff;
            font-family: sans-serif;
            margin: 0;
            padding: 15px;
        }
        .header { margin-bottom: 20px; font-weight: bold; font-size: 1.2em; }
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .item {
            background: var(--card);
            border: 1px solid #2d313d;
            border-radius: 12px;
            padding: 12px;
            font-size: 13px;
            border-bottom: 4px solid var(--rare);
        }
        .item-count {
            color: var(--accent);
            font-weight: bold;
            margin-top: 5px;
            display: block;
        }
        .empty { text-align: center; color: #555; padding-top: 50px; }
    </style>
</head>
<body>
    <div class="header" id="title">Инвентарь</div>
    <div id="app" class="grid"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        function render() {
            const app = document.getElementById('app');
            const title = document.getElementById('title');
            
            // Получаем данные из URL (#data=...)
            const hash = window.location.hash;
            if (!hash || !hash.startsWith('#data=')) {
                app.innerHTML = '<div class="empty">Данные не найдены.<br>Запустите через бота.</div>';
                return;
            }

            try {
                const base64Data = hash.split('=')[1];
                // Декодируем Base64 в JSON
                const decodedStr = decodeURIComponent(escape(atob(base64Data)));
                const items = JSON.parse(decodedStr);

                if (tg.initDataUnsafe.user) {
                    title.innerText = `Инвентарь: ${tg.initDataUnsafe.user.first_name}`;
                }

                app.innerHTML = items.map(item => `
                    <div class="item">
                        <div>${item.n}</div>
                        <span class="item-count">Кол-во: ${item.a}</span>
                    </div>
                `).join('');

            } catch (e) {
                app.innerHTML = '<div class="empty">Ошибка обработки данных.</div>';
                console.error(e);
            }
        }

        render();
    </script>
</body>
</html>
